[tox]
requires =
    tox>4
    virtualenv>20.2
labels =
    testenv = py311
env_list =
    lint
    create
    converge
    converge-monorepo
    destroy
    libvirt
    dependency
[testenv:lint]
setenv =
    DEPENDENCY_ENABLED=False
deps =
    -r requirements.txt
commands = molecule lint
[testenv:dependency]
deps =
    -r requirements.txt
commands = molecule dependency

[testenv:create]
setenv =
    DEPENDENCY_ENABLED=False
deps =
    -r requirements.txt
commands = molecule dependency
[common-converge]
setenv =
    ANSIBLE_ROLES_PATH={toxinidir}/../community:{toxinidir}/../oss:{toxinidir}/..
    ANSIBLE_COLLECTIONS_PATH={toxinidir}/../community-collections
[testenv:converge]
setenv =
    {[common-converge]setenv}
deps =
    -r requirements.txt
commands = molecule converge
[testenv:destroy]
setenv =
    DEPENDENCY_ENABLED=False
deps =
    -r requirements.txt
commands =
    molecule destroy
[testenv]
setenv =
    {[common-converge]setenv}
deps =
    -r requirements.txt
commands = molecule test

[testenv:libvirt]
setenv =
    {[common-converge]setenv}
deps =
    -r requirements.txt
commands = molecule test --scenario-name kvm

